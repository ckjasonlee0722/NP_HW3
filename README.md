# NP_HW3
A course I took in fall semester 2025

🎮 Network Programming HW3 - Online Game Platform
這是一個基於 Socket 的線上遊戲平台，包含大廳系統、會員機制、遊戲商城以及多款連線遊戲（Click War, Tetris Battle）。

📋 環境需求 (Prerequisites)
Python: 3.10 或更高版本

Libraries: 需要安裝 pygame (用於遊戲畫面)

Bash

pip install pygame
🚀 快速啟動 (How to Run Client)
由於伺服器部署於學校 Linux 工作站 (linux1)，且為了繞過防火牆對隨機 Port 的限制，本專案採用 SSH Tunneling 技術。

⚠️ 請務必依照以下步驟連線，否則無法進入遊戲畫面。

步驟 1：建立 SSH 雙通道 (SSH Tunneling)
請開啟一個終端機 (Terminal / PowerShell)，執行以下指令。這會將本地的 33002 (大廳) 和 33003 (遊戲固定端口) 轉發至遠端伺服器。

請將 <your_student_id> 替換為你的學號 (linux1 登入帳號)：

Bash

# 格式: ssh -L [本地Port]:[遠端IP]:[遠端Port] [帳號]@[主機]
# 注意：必須同時包含 -L 33002 和 -L 33003
ssh -L 33002:127.0.0.1:33002 -L 33003:127.0.0.1:33003 <your_student_id>@linux1.cs.nycu.edu.tw
重要提示： 輸入密碼登入成功後，請保留此視窗開啟（不要關閉），這代表連線通道已建立。

步驟 2：啟動遊戲客戶端 (Player Client)
開啟另一個 新的 終端機，執行以下指令連線至平台：

Bash

# 請連線至 127.0.0.1，SSH 通道會自動將封包轉發至學校伺服器
python player_client.py --host 127.0.0.1 --port 33002
步驟 3：開始遊玩
註冊/登入：輸入任意帳號密碼註冊。

瀏覽商城：下載 Click_War 或 Tetris_Battle。

建立房間：選擇遊戲並設定人數 (建議選擇 2 人以便測試)。

加入房間：開啟第二個 Client (重複步驟 2)，加入剛剛建立的房間。

🛠️ 開發者工具 (Developer Client)
如果您需要上傳新的遊戲檔案 (.zip) 到伺服器，請使用開發者客戶端：

Bash

python developer_client.py --host 127.0.0.1 --port 33002
支援功能：上架遊戲、下架遊戲、查看遊戲清單。

📂 專案結構 (Project Structure)
Plaintext

.
├── client.py               # 遊戲通用 Client 邏輯
├── server.py               # 遊戲通用 Server 邏輯
├── player_client.py        # 玩家大廳客戶端 (主要進入點)
├── developer_client.py     # 開發者上傳工具
├── utils/                  # 通訊協定模組 (Protocol)
│   └── protocol.py
├── downloads/              # 玩家下載的遊戲存放區
├── games/                  # 遊戲原始碼 (Click_War, Tetris_Battle)
└── README.md
⚙️ 伺服器部署資訊 (Server Deployment)
目前的伺服器已部署並運行中：

Host: linux1.cs.nycu.edu.tw (140.113.235.151)

Database Server: Port 33001

Lobby Server: Port 33002

Game Server: Port 33003 (Fixed Port for Tunneling)

Process Owner: hslee

自行架設 Server (Localhost)
若您需要自行在本地架設伺服器，請參考以下指令：

Bash

# 1. 啟動資料庫
python db_server/db_server.py --port 33001

# 2. 啟動大廳 (Linux 環境需設定 PYTHONPATH)
# 注意：本地測試時 public-host 請設為 127.0.0.1
export PYTHONPATH=$PYTHONPATH:.
python lobby_server/lobby_server.py --port 33002 --dbhost 127.0.0.1 --dbport 33001 --public-host 1

開發者（Developer）

開發者端需要使用開發者帳號登入後才能操作，且此帳號身分與一般 Player 帳號互相獨立。

在所有與遊戲管理相關的操作（上架 / 更新 / 下架）中，開發者只能操作與自己帳號相關的遊戲（例如自己建立或被指派管理的遊戲），不得直接修改其他開發者的作品。

以下是幾個推薦的 Use Case 範例，作為你設計與實作 Developer 端功能的參考。

實作時不強制要求流程一模一樣，但應達成相同的使用目標。

Use Case D1：開發者上架一款新遊戲

目標

讓開發者可以把本地已完成的遊戲，上架到平台，讓玩家之後可以在商城中看到並下載遊玩。

前置條件

開發者已在本地完成至少一款可執行的遊戲版本。

開發者端程式（Developer Client）已能成功連線到後端（Developer Server）。

開發者已經在系統中有可辨識的身分（例如帳號、名稱或其他識別方式），並已成功登入。

步驟（實作時可調整具體互動細節）

開發者啟動 Developer Client，登入並進入「開發者主選單」。

開發者在選單中選擇「上架新遊戲」或功能名稱相近的選項。

系統引導開發者輸入或選擇必要資訊，例如：遊戲名稱

簡短介紹或描述

遊戲類型（CLI / GUI / 人數上限等）

要上傳的遊戲位置（或由系統提供可選的清單）

遊戲相關的設定檔（例如 config 檔），可以選擇手動輸入設定，也可以直接由配置檔讀取，確保上架內容本身就包含啟動與連線所需的資訊

開發者確認送出上架申請。

系統與 Server 端互動，完成遊戲資訊與檔案的上傳。

上傳完成後，系統顯示上架成功的回饋訊息，並能讓開發者看見這款遊戲已出現在「我的遊戲列表」中。

錯誤處理情境（範例）

以下為建議情境，實作時可依自己設計調整：

若必填欄位未填（例如遊戲名稱或類型），系統應提示缺少哪一項資料，並要求補齊後才能送出。

若選取的遊戲路徑不存在或檔案無法讀取，系統應顯示清楚的錯誤訊息，而不是直接關閉程式。

若 config 檔缺少必要欄位（例如啟動指令或連線埠），系統可以：提示缺少的欄位名稱，並允許使用者改用手動輸入補上，或

拒絕上架並說明原因。

若 Server 端暫時無法連線或上傳失敗，系統應提示「上架失敗」與簡要原因（例如連線逾時），並提供重試或取消的選項。

預期結果

開發者可以清楚知道這款遊戲是否已成功上架，若失敗也能知道原因並有機會修正後重試。

在商城 / 大廳相關介面中，可以看到這款新遊戲的基本資訊。

之後玩家能透過 Player 端流程，下載並遊玩這款遊戲。

Use Case D2：開發者更新已上架遊戲版本

目標

當開發者修正 Bug 或增加新功能時，可以更新已上架的遊戲版本，而不需要重新建立新的遊戲條目。

前置條件

Game Store 中已存在一款由此開發者上架的遊戲。

開發者在本地已準備好新的遊戲版本。

開發者端程式可以辨識「哪一款遊戲要被更新」，並確認該遊戲屬於目前登入的開發者帳號。

步驟

開發者啟動 Developer Client，登入並進入「我的遊戲」或類似功能。

系統列出開發者已上架的遊戲清單（包含目前版本資訊）。

開發者選擇其中一款要更新的遊戲。

系統引導開發者指定新的版本（例如：輸入版本號、選擇新檔案來源、撰寫更新說明等）。

開發者確認更新。

系統將新的遊戲內容與版本資訊送到 Server 端，並在完成後給出明確的成功訊息。

錯誤處理情境（範例）

若開發者嘗試更新不屬於自己帳號的遊戲，系統應拒絕操作並提示「無權限更新此遊戲」。

若指定的新版本檔案不存在或讀取失敗，系統應顯示錯誤並要求重新選擇。

若版本號格式不合法（例如空白或重複使用舊版號且未被允許），系統應提示錯誤並要求重新輸入。

若在更新過程中與 Server 連線中斷，系統應回報「更新失敗」，並清楚區分：伺服器端實際是否已更新成功（若可以查詢），或

需要使用者重新嘗試更新。

預期結果

這款遊戲在後台被標記為最新版本。

之後玩家在下載或更新這款遊戲時，會以新版本為主。

若有玩家仍持有舊版本，系統可以在之後的設計中，透過更新或提示方式引導他們升級（具體方式請自行決定）。

Use Case D3：開發者下架一款遊戲

目標

讓開發者可以從商城中暫時或永久移除一款遊戲，避免玩家繼續下載或建立新房間。

前置條件

系統中已存在由該開發者上架的遊戲。

開發者有權限操作該遊戲（例如不是其他作者的作品）。

步驟

開發者啟動 Developer Client，登入並進入「我的遊戲」清單。

系統列出該開發者目前已上架的遊戲。

開發者選擇要下架的遊戲，並在選單中選擇「下架」或相似功能。

系統提示下架後的影響（例如：無法再被新玩家下載或建立新房間）。

開發者確認下架。

系統將下架請求送至 Server，並在完成後給出明確的回饋。

錯誤處理情境（範例）

若開發者嘗試下架不屬於自己帳號的遊戲，系統應拒絕並提示「無權限下架此遊戲」。

若該遊戲目前仍有進行中的房間或遊戲局，系統可以：阻止下架並提示需先關閉相關房間，或

允許標記為「不再接受新房間」，但保留現有房間（具體策略由各組自行設計）。

若與 Server 溝通時發生錯誤（例如連線失敗），系統應提示「下架失敗」並保留原狀，不應出現前後端狀態不一致而讓遊戲「半消失」。

預期結果

該遊戲不再出現在一般玩家可見的「可下載 / 可遊玩」列表中。

已經下載或正在遊玩的玩家行為，由各組自行設計（例如：允許舊玩家繼續遊玩、或在下次啟動時給予提示等）。玩家（Player）

玩家端需要具備玩家帳號的註冊與登入機制，並與開發者帳號分開管理。登入後的玩家身分，會影響其能看到與能操作的資訊，例如：



僅能使用自己的玩家身分加入房間、建立房間、發送聊天訊息等

評分與留言必須能追溯到實際玩家帳號

不同權限的玩家（例如一般玩家、管理員）可以在系統中被區分，實作時可以自行設計等級與對應行為

以下是幾個推薦的 Use Case 範例，作為你設計與實作 Player 端功能的參考。

實作時不要求逐步完全一樣，但應達成類似的玩家體驗。

Use Case P1：玩家瀏覽遊戲商城與詳細資訊

目標

讓玩家可以在一個清楚的介面中，看到目前有哪些遊戲可以遊玩，並能查看每款遊戲的基本說明與評價。

前置條件

玩家已經擁有玩家帳號，並成功登入 Lobby Client。

至少有一款遊戲已在平台上架。

Player 端程式（Lobby Client）已能成功連線到 Lobby / Store 相關服務。

步驟

玩家啟動 Lobby Client，進入「商城」或「遊戲列表」相關選單。

系統顯示目前可供下載或遊玩的遊戲列表（例如以表格或列表呈現）。

玩家從列表中選擇一款遊戲。

系統顯示該遊戲的詳細資訊，例如：遊戲名稱與作者

遊戲簡介

支援人數、遊戲類型

評分與部分玩家評論（若有）

玩家可以選擇返回列表、或進一步進行下載 / 建立房間等後續操作。

錯誤處理情境（範例）

若目前沒有任何上架遊戲，系統應清楚顯示「目前沒有可遊玩的遊戲」，而不是呈現空白畫面。

若在載入遊戲列表時與 Server 連線失敗，系統應提示「列表載入失敗」並提供重新整理或稍後重試的選項。

若某些遊戲資訊缺漏（例如缺少簡介），系統可以：顯示預設文案（例如「尚未提供簡介」），而不是中斷整個列表的顯示。

預期結果

玩家能夠清楚理解每款遊戲的基本特性與玩法概念。

玩家在決定要下載或遊玩前，不需要查閱外部文件或口頭說明。

Use Case P2：玩家下載並更新遊戲版本

目標

讓玩家可以在開始遊玩前，一鍵下載或更新到某款遊戲的最新可用版本。

前置條件

該遊戲已在平台上架，且有至少一個可下載版本。

玩家端具備基本儲存空間與權限，能在本地建立下載目錄。

步驟

玩家在 Lobby Client 的選單中，選擇「下載遊戲」或同類功能。

系統列出目前可供下載的遊戲。

玩家選擇其中一款遊戲。

若玩家尚未下載過該遊戲，系統執行「首次下載」流程。

若玩家已有舊版本，系統可以：

呈現目前本地版本與伺服器版本的差異，或

直接提示「有新版本，是否更新」。

玩家確認下載或更新。

系統向 Server 索取檔案，並在下載完成後給出成功提示。

錯誤處理情境（範例）

若下載過程中連線中斷或檔案損毀，系統應標記該下載為失敗，不應讓半套檔案被誤當成可用版本，並提供重新下載選項。

若伺服器回報該版本已被下架或不存在，系統應提示玩家「此版本已不可下載」，並返回遊戲列表。

預期結果

對玩家來說，「我要玩某款遊戲」之前，不需要自己去找檔案路徑，只要透過一個明確的操作就能取得最新版本。

系統能清楚辨識玩家目前持有的版本狀態，避免玩家在不知情下長期停留在舊版本。

Use Case P3：玩家建立房間並啟動遊戲

目標

讓玩家可以透過簡單的操作，完成「選擇遊戲 → 建立房間 → 啟動遊戲並連線到對應 Server」的流程。

前置條件

Player 端可以連線到 Lobby Server。

玩家欲遊玩的遊戲已經在本地完成下載，或系統能在流程中自動協助下載。

步驟

玩家在 Lobby Client 中選擇「建立房間」或「開始遊戲」相關功能。

系統自動列出目前可用的遊戲列表（或玩家先選遊戲，再選擇建立房間）。

玩家選擇一款遊戲。

系統檢查玩家是否已有對應版本：若尚未下載，提示玩家下載並完成後再繼續。

若有舊版本，可視設計提示更新。

條件滿足後，系統向 Lobby Server 發出建立房間請求。

房間建立成功後，系統顯示房間資訊（例如房號、目前人數、遊戲名稱等）。

根據系統設計，玩家端啟動對應的 game client，並連線到相應的 game server。

錯誤處理情境（範例）

若在建立房間時，該遊戲已被開發者下架或標記為不再接受新房間，系統應拒絕建立並提示原因。

若 Lobby Server 回報目前人數已達上限，系統應告知玩家無法建立新房間，並可建議加入其他現有房間（若有）。

若啟動 game client 或連線到 game server 失敗（例如連線逾時、port 不通），系統應：顯示錯誤原因（簡短即可），並

將玩家狀態退回到合理位置（例如回到房間或大廳），避免卡在「半進入遊戲」的狀態。

預期結果

玩家可以在不需要理解底層連線細節的情況下，順利從大廳進入遊戲。

房間狀態在大廳中有清楚反映，例如可以看到新建立的房間、目前等待中的玩家等。

Use Case P4：玩家對遊戲進行評分與留言

目標

提供玩家在遊戲結束後，能對遊戲進行簡單的評分與文字回饋，讓其他玩家與開發者能參考。

前置條件

玩家曾經成功啟動並結束某款遊戲的遊玩流程。

系統有儲存基本遊戲紀錄或能辨認「哪些玩家玩過這款遊戲」。

步驟

玩家在 Lobby Client 中，進入「我的紀錄」或在遊戲詳細資訊畫面中，選擇「評分與評論」相關功能。

系統確認玩家是否具備評分資格（例如真的玩過這款遊戲）。

玩家輸入評分（例如 1–5 分）與可選擇的評論文字。

玩家送出評價。

系統將評分與留言傳送至 Server，並在成功儲存後顯示回饋。

錯誤處理情境（範例）

若玩家尚未實際遊玩該遊戲，系統應拒絕建立評價，避免出現「未玩先評」的情況。

若評分超出允許範圍（例如輸入 0 或 10），系統應提示合法範圍並要求重新輸入。

若評論內容過長或包含無法處理的字元，系統可以：限制字數並提示玩家縮短內容，或

提供明確的失敗原因而不是直接丟失輸入內容。

若在送出評價時與 Server 連線失敗，系統應保留玩家剛剛輸入的內容（例如暫存在記憶體或檔案中），並允許玩家稍後重試送出，而不是整段內容直接消失。

預期結果

未來在查看遊戲詳細資訊時，可以看到來自多位玩家的平均評分與部分評論。

開發者可以參考這些留言，作為後續更新與調整的依據（實際如何呈現請自行設計）。評分機制

配分說明

本作業總分：100 分，另外有最多 20 分加分項目。



系統功能完整度（Use Case，共 55 分）

依照下列 Use Case 完成度給分：

Use Case描述分數D1開發者上架一款新遊戲10 分D2開發者更新已上架遊戲版本10 分D3開發者下架一款遊戲5 分P1玩家瀏覽遊戲商城與詳細資訊5 分P2玩家下載並更新遊戲版本10 分P3玩家建立房間並啟動遊戲10 分P4玩家對遊戲進行評分與留言5 分

遊戲實作程度（15 分，闖關制）

依照實際完成的遊戲型態與驗收結果給分，採「闖關制」，每一關 5 分，最高 15 分：

關卡 A：雙人 CLI 遊戲（5 分）至少支援 2 位玩家對戰

可以從「開始遊戲 → 進行對戰 → 結束並看到結果」完整跑完一局

過程中不會在一般情況下當機或卡死

關卡 B：GUI 介面（+5 分）有基本圖形介面（視窗、按鈕或畫面顯示，不限框架）

雙人對戰的主要操作可以透過 GUI 完成（不需要再打指令）

遊戲狀態會在 GUI 上正確更新（例如棋盤、分數、回合結果等）

關卡 C：多人 GUI 同局遊玩（+5 分）同一場遊戲中，實際能有 3 位（含）以上玩家 一起遊玩

多位玩家的連線與狀態更新邏輯正確（例如輪流／同步機制合理）

Demo 時，助教可以實際操作至少 3 個玩家帳號跑完一局

若某關卡僅部分達成（例如 GUI 有但無法完整對戰），該關卡分數可視實際情況給 0 ～ 3 分。

系統架構與正確性（5 分）

三種角色與模組切分是否清楚（Server / Developer / Player）

版本管理與檔案來源區分是否合理（Developer 端 / Server 上架版本 / Player 下載版本）

資料在 Server 重啟後是否仍能正確維持

使用者體驗與介面設計（5 分）

Menu 結構是否清楚、層級合理（不會塞爆在同一層）

Demo 流程是否直覺，助教大致依照 README 就能自己從「上架 → 遊玩」跑完

錯誤訊息是否清楚（輸入錯誤、連線失敗、版本衝突等不會只顯示 error code）

程式碼品質與文件（5 分）

程式碼結構與命名是否有基本可讀性，不是完全 Spaghetti

README 是否足夠讓助教在新環境啟動 Developer / Lobby Client 並完成基本操作

口頭問答與系統理解（15 分）

助教會在 Demo 現場出一些題目，請同學現場說明或實作，例如：

說明你們的系統架構與模組切分方式（Server / Developer / Player 如何溝通）

如果要新增某個功能（例如新的遊戲類型、額外的資料欄位），你會怎麼改？

某些 Bug 或極端情況（例如 Lobby 掛掉、某個 game server 卡住）在你們的架構下要怎麼處理？

也有可能會請你現場修改程式碼或設定，所以請務必了解自己的程式架構，並在開發時保留一定的擴充性。

ssh -L 33002:127.0.0.1:33002 -L 33003:127.0.0.1:33003 -L 33004:127.0.0.1:33004 -L 33005:127.0.0.1:33005 hslee@linux1.cs.nycu.edu.tw